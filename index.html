<canvas id="15-puzzle"></canvas>
<script>
	window.onload = function() {
		var W = window.innerHeight/2, H = W;
		var canvas = document.getElementById('15-puzzle');
		var ctx = canvas.getContext('2d');
		var frames, time;
		canvas.width = W;
		canvas.height = H;
		var tileWidth = W/4, tileHeight = H/5;
		ctx.font = tileHeight/2 + 'px Helvetica';

		var tiles = {
			tiles: [[0, 1, 2, 3], [4, 5, 6, 7], [8, 9, 10, 11], [12, 13, 14, 15]],
			rightTiles: [[1, 2, 3, 4], [5, 6, 7, 8], [9, 10, 11, 12], [13, 14, 15, 0]],
			draw: function() {
				var x = 0, y = 0;
				ctx.strokeStyle = "#FFF";
				var tile, width, height, posX, posY;
				for (var i = 0; i < this.tiles.length; i++) {
					for (var j = 0; j < this.tiles[0].length; j++) {
						tile = this.tiles[i][j];
						if(tile[0] !== 0){
							width = ctx.measureText(tile).width;
							height = tileHeight/2;
							posX = x * tileWidth + (tileWidth - width)/2;
							posY = y * tileHeight + tileHeight - (height/2);
							var fillStyle;
							tile[0] === this.rightTiles[i][j] ? fillStyle = "#0F0": fillStyle = "#FFF";
							ctx.fillStyle = fillStyle;
							ctx.fillText(this.tiles[i][j], posX, posY);
							ctx.beginPath();
							ctx.rect(x * tileWidth, y * tileHeight, tileWidth, tileHeight);
							ctx.stroke();
						}
						x++;
					}	
					x = 0;
					y++;
				}
			},
			randomize: function() {
				var aux = [];
				for (var i = 0; i < this.tiles.length; i++) {
					for (var j = 0; j < this.tiles[0].length; j++) {
						aux.push(this.tiles[i][j]);
					}
				}
				aux = shuffle(aux);
				for (var i = 0; i < this.tiles.length; i++) {
					for (var j = 0; j < this.tiles[0].length; j++) {
						this.tiles[i][j] = aux[j+i*4];
					}
				}
			}
		}

		function init() {
			tiles.randomize();
			frames = 0, time = 0;
			run();
		}
		function run() {
			frames++;
			update();
			draw();
			window.requestAnimationFrame(run, canvas);
		}
		function update() {
			if(frames % 60 === 0) {
				if(time < 999){
					time++;
				}
			}
			console.log(time);
		}
		function draw() {
			drawBackground();
			tiles.draw();
		}
		function drawBackground() {
			ctx.fillStyle = "#000";
			ctx.fillRect(0, 0, W, H);
			ctx.fillStyle = "#AAA";
			ctx.fillRect(0, tileHeight * 4, tileWidth*4, tileHeight);
			drawRestart();
			drawTime();
		}
		function drawRestart() {
			ctx.strokeStyle = "#FFF";
			ctx.beginPath();
			ctx.rect(0, tileHeight * 4, tileWidth * 2.5, tileHeight);
			ctx.stroke();
			var text = "RESTART";
			var width = ctx.measureText(text).width;
			var height = tileHeight/2;
			var textX = (tileWidth * 2.5 - width)/2;
			var textY = tileHeight * 5 - (height/2);
			ctx.fillStyle = "#000";
			ctx.fillText(text, textX, textY);
		}
		function drawTime() {
			ctx.strokeStyle = "#FFF";
			ctx.beginPath();
			ctx.rect(tileWidth * 2.5, tileHeight * 4, tileWidth * 1.5, tileHeight);
			ctx.stroke();
			var width = ctx.measureText(time).width;
			var height = tileHeight/2;
			var textX = tileWidth * 2.5 + (tileWidth * 1.5 - width)/2;
			var textY = tileHeight * 5 - (height/2);
			ctx.fillStyle = "#000";
			ctx.fillText(time, textX, textY);	
		}
		init();
		function shuffle(array) {
			var s = [];
			while (array.length) 
				s.push(array.splice(Math.random() * array.length, 1));
			while (s.length) 
				array.push(s.pop());
			return array;
		}
	}
</script>